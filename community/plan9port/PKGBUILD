# $Id: PKGBUILD 7854 2010-01-12 01:29:54Z dgriffiths $
# Contributor: phrakture <aaronmgriffin--gmail--com>

pkgname=plan9port
pkgver=20051127
pkgrel=1
pkgdesc="Plan 9 from User Space (aka plan9port) is a port of many Plan 9 \
	programs from their native Plan 9  environment to Unix-like operating \
	systems."
arch=('i686' 'x86_64')
url="http://swtch.com/plan9port/"
license=('custom')
depends=('x-server')
makedepends=('cvs')
install=plan9.install
source=(http://swtch.com/$pkgname/$pkgname.tgz plan9.sh LICENSE)
md5sums=('e8a218787b34d5e47efee5c30966355c'
         '9695eb15a247e23140e8a35ff52a5c20'
	 'c0498a4e12818186e5651425cfd210c6')

build()
{
  mkdir -p $startdir/pkg/etc/profile.d
  cp $startdir/src/plan9.sh $startdir/pkg/etc/profile.d/

  mkdir $startdir/pkg/opt
  mv $startdir/src/plan9 $startdir/pkg/opt

  cd $startdir/pkg/opt/plan9
  cvs update #make sure we're up to date...
  ./INSTALL

  #don't need these in the package
  rm install.log
  rm -r src/
  find . -name CVS -exec rm -rf {} \;

  borkedfiles=`grep -r $startdir/pkg/opt/plan9 * | grep -v Binary | cut -d\: -f1`
  for f in $borkedfiles; do
    echo "fixing hardcoded paths in $f"
    sed -i "s@$startdir/pkg/opt/plan9@/opt/plan9@" $f
  done

  install -Dm644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE
}
