# Contributor: Aaron Griffin <aaronmgriffin@gmail.com>
# Maintainer: Daniel J Griffiths <ghost1227@archlinux.us>

pkgname=avbin
pkgver=7
pkgrel=1
pkgdesc="Cross-platform media decoding library"
arch=('i686' 'x86_64')
url="http://code.google.com/p/avbin/"
license=('GPL3')
depends=('ffmpeg')
source=(http://avbin.googlecode.com/files/$pkgname-src-$pkgver.tar.gz
	av_log.patch sample_fmt.patch Makefile.arch)
md5sums=('9c08f4f6e778021dcd154e11fd0f79ad' '34394d080087b03f3d52ccbd7b1a5977'
	 '7e87073d85caa96d5d9d1b4be0d6bcae' '83d6527fcd00ea471a3f321949c2cf9d')

build() {
	cd ${srcdir}/${pkgname}-src-${pkgver}

	#echo used to strip spaces
	ffvers="$(echo $(pacman -Qi ffmpeg | grep Version | cut -d: -f2 | cut -d- -f1))"

	patch -up1 < "${srcdir}/av_log.patch"
	patch -up1 < "${srcdir}/sample_fmt.patch"
	cp "${srcdir}/Makefile.arch" .
	make -f Makefile.arch CARCH=$CARCH AVBIN_VERSION="$(cat VERSION)" FFMPEG_REVISION="$ffvers"
}

package() {
	cd ${srcdir}/${pkgname}-src-${pkgver}

	mkdir -p "${pkgdir}/usr/lib/"
	cp -r dist/* "${pkgdir}/usr/lib/"
}
