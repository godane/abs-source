# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=usb_modeswitch
pkgver=1.1.2
pkgrel=1
_pkgdata=20100418
pkgdesc="Activating switchable USB devices on Linux."
arch=('i686' 'x86_64')
url="http://www.draisberghof.de/usb_modeswitch/"
license=('GPL')
depends=('libusb' 'tcl')
makedepends=('gcc' 'make') # 'wget')
backup=('etc/$pkgname.conf')
source=("http://www.draisberghof.de/usb_modeswitch/usb-modeswitch-${pkgver}.tar.bz2"
	"http://www.draisberghof.de/usb_modeswitch/usb-modeswitch-data-${_pkgdata}.tar.bz2"
	"http://www.draisberghof.de/usb_modeswitch/usb_modeswitch.setup")
md5sums=('071cb300d00938bfe20025c654303d92'
         '659c9633513fa2f84465244a50c351b3'
         '9a25756669937ac86774bb55733f09cd')

build() {
  cd $srcdir

  # fetching
#  wget -Nc http://www.draisberghof.de/usb_modeswitch/usb_modeswitch.setup || return 1

  # extracting
  cd $srcdir/usb-modeswitch-$pkgver/
  mkdir -p $pkgdir/lib/udev/usb_modeswitch || return 1
  mkdir -p $pkgdir/etc || return 1
  mkdir -p $pkgdir/usr/share/man/man1 || return 1

  # deleting the precompiled binary
  make clean || return 1
  # recompiling
  make || return 1
  # installing
  make DESTDIR=${pkgdir} install || return 1
  # adjusting the tcl script location
  mv ${pkgdir}/lib/udev/usb_modeswitch/usb_modeswitch.tcl ${pkgdir}/lib/udev/usb_modeswitch.tcl || return 1
  rmdir ${pkgdir}/lib/udev/usb_modeswitch || return 1
  mv ${pkgdir}/lib/udev/usb_modeswitch.tcl ${pkgdir}/lib/udev/usb_modeswitch  || return 1

  # installing data
  cd $srcdir/usb-modeswitch-data-${_pkgdata} || return 1
  make DESTDIR=$pkgdir install || return 1
  # installing config
  cp $srcdir/usb_modeswitch.setup $pkgdir/etc/ || return 1
}
